
Do(function() {
  if (window.__init_review_list) {
    return;
  }
  __init_review_list = true;
  var _URL_LIBS = 'https://img3.doubanio.com/f/zerkalo/88af85e84430a9f18c8e8eac13a2ccac24bbbc26/js/review/editor/libs.js';
  var _URL_SETTING_JS = 'https://img3.doubanio.com/f/zerkalo/a1b84b6a0ac5ad53cc5a9ab065705c18edb0703a/js/review/editor/ng/setting_standalone.js';
  var _URL_SETTING_CSS = 'https://img3.doubanio.com/f/zerkalo/7766e4ec54c60b316dda0c982278c71b25fccd84/css/review/editor/ng/setting_standalone.css';
  !function(t){function e(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,e,n){Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=153)}({153:function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}var i=n(17),r=o(i);n(68),window._IMAGE_GIF_RENDER=r.default},17:function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(35),r=o(i);e.default=r.default},31:function(t,e){"use strict";t.exports=function(t){"complete"===document.readyState||"interactive"===document.readyState?t.call():document.attachEvent?document.attachEvent("onreadystatechange",function(){"interactive"===document.readyState&&t.call()}):document.addEventListener&&document.addEventListener("DOMContentLoaded",t)}},33:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n){return t.addEventListener?(t.addEventListener(e,n,!1),{remove:function(){t.removeEventListener(e,n,!1)}}):t.attachEvent?(t.attachEvent("on"+e,n),{remove:function(){t.detachEvent("on"+e,n)}}):void 0}},34:function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function i(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("undefined"!=typeof t&&null!=t){if(!(this instanceof i))return new i(t);var e=t.getAttribute("data-inited");e||(this.options={el:t,container:t.parentNode,prefetch:!0,previewUrl:t.getAttribute("src"),originUrl:t.getAttribute("data-original-url")},this._fetchUrl=this.options.originUrl,this.init())}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(33),a=o(r);i.prototype.prefetch=function(t){if(t&&this.options.prefetch){var e=document.createElement("link");e.rel="prefetch",e.href=t;var n=document.getElementsByTagName("link")[0];n.parentNode.insertBefore(e,n)}},i.prototype.play=function(){var t=this.options.el;t.src=this._fetchUrl,this._buttonPlay.style.display="none",this._buttonReload.style.display="none",this._loading.style.display="block"},i.prototype.reload=function(){this._buttonPlay.style.display="none",this._buttonReload.style.display="none",this._loading.style.display="block";var t=this.options.originUrl,e="_r="+Math.random();this._fetchUrl=t.indexOf("?")+1?t+"&"+e:t+"?"+e,this.play()},i.prototype.loaded=function(t){var e=this.options,t=e.el,n=e.container;t.src===this._fetchUrl&&(this._buttonPlay_click.remove(),this._buttonReload_click.remove(),this._img_load_error.remove(),this._img_load.remove(),n.removeChild(this._panel))},i.prototype.notFound=function(){var t=this.options,e=t.el,n=t.previewUrl;e.src=n,this._buttonPlay.style.display="none",this._buttonReload.style.display="block",this._loading.style.display="none"},i.prototype.init=function(){var t=this,e=this.options,n=e.el,o=e.container,i=(e.originUrl,this._panel=document.createElement("div")),r="image-gif-button-play",l="image-gif-loading",s="image-gif-button-reload";i.className="image-gif-panel",i.innerHTML='\n    <div class="image-gif-panel-inner">\n      <a href="javascript:;" class="'+r+'">GIF</a>\n      <a href="javascript:;" class="'+s+'" style="display: none">重新加载</a>\n      <span class="'+l+'" style="display: none;">加载中</span>\n    </div>\n  ',o.appendChild(i),this._buttonPlay=i.getElementsByClassName(r)[0],this._buttonReload=i.getElementsByClassName(s)[0],this._loading=i.getElementsByClassName(l)[0],this.prefetch(this._fetchUrl);var u=function(e){return function(n){n.preventDefault?n.preventDefault():n.returnValue=!1,e.call(t,n.target||n.srcElement,n.loaded?n.loaded/n.total:-1)}};this._buttonPlay_click=(0,a.default)(this._buttonPlay,"click",u(this.play)),this._buttonReload_click=(0,a.default)(this._buttonReload,"click",u(this.reload)),this._img_load=(0,a.default)(n,"load",u(this.loaded)),this._img_load_error=(0,a.default)(n,"error",u(this.notFound)),n.setAttribute("data-inited",!0)},e.default=i},35:function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function i(){r=[];for(var t,e=document.querySelectorAll("img[data-render-type=gif]"),n=0;t=e[n];)r.push((0,c.default)(t)),n++;if("object"===("undefined"==typeof a?"undefined":l(a))&&"preloadNum"in a)for(var o=a.preloadNum;o--;)r[o]&&r[o].play()}Object.defineProperty(e,"__esModule",{value:!0});var r,a,l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=n(31),u=o(s),d=n(34),c=o(d);e.default=function(t){a=t,(0,u.default)(i)}},68:function(t,e){}});
  !function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=n(2),o=r(i);!function(){"loading"!==document.readyState?(0,o.default)(document):document.addEventListener?document.addEventListener("DOMContentLoaded",function(){return(0,o.default)(document)},!1):window.attachEvent("onreadystatechange",function(){"loading"!==document.readyState&&(0,o.default)(document)})}()},,function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=n(3),o=r(i);e.exports=function(){for(var e=void 0,t=document.querySelectorAll(".review-list .toggle_review")||[],n=t.length,r=(function(){return"_IMAGE_GIF_RENDER"in window&&setTimeout(function(){return window._IMAGE_GIF_RENDER()},300)}),i=function(t){var n=t.target,i=n.className,a=t.target.id,l=a.split("-")[1]||"",u=$("#toggle-"+l+".indicator"),d=i.match(/unfold/g),c=document.getElementById("review_"+l+"_short"),s=document.getElementById("review_"+l+"_full"),f=document.getElementById("review_"+l+"_full_content"),g=s.className.match(/loaded/g);e="/j/review/"+l+"/full",t.preventDefault(),d&&!g?($.ajaxSetup({cache:!0}),$.getJSON(e,function(e,t){f.innerHTML=e.body,s.classList.add("loaded"),s.classList.toggle("hidden"),c.classList.toggle("hidden"),u.toggleClass("unfold"),n.setAttribute("title","收起全文"),(0,o.default)(document),r()})):(s.classList.toggle("hidden"),c.classList.toggle("hidden"),u.toggleClass("unfold"),n.setAttribute("title","展开全文"))},a=0;a<n;a++)t&&t[a].addEventListener("click",i,!1);$(".btn-unfold").bind("click",function(e){e.preventDefault();var t=$(e.target),n=t.parent(".fold-hd");n.slideUp().next().slideDown()})}},function(e,t){"use strict";e.exports=function(){var e={useful_count:["有用","/j/review/{REVIEW_ID}/useful"],useless_count:["没用","/j/review/{REVIEW_ID}/useless"],spoiler:["剧透提醒已提交，谢谢","/j/review/{REVIEW_ID}/spoiler"]},t=/disabled/,n=/(\w+_count)/,r=/spoiler/,i=document.querySelectorAll(".main-panel-useful"),o=null,a="",l=function(e){return e&&"true"===e.getAttribute("data-is_owner")},u=function(e){return e&&"true"===e.getAttribute("data-can_vote")},d=function(i){i.stopPropagation();var o=i.target,d=o.className,f=d.match(n)||d.match(r),g="",m="",v="";if(!d.match(t)){if(f){if(l(i.currentTarget))return alert("不能给自己投票噢");if(!u(i.currentTarget))return alert("该电影还未上映，不能投票噢");g=f[0],v=e[g][0],m=e[g][1],a=i.currentTarget.getAttribute("data-rid"),m=m.replace("{REVIEW_ID}",a)}else if(!f||!a)return;var _=$.post(m,{ck:get_cookie("ck")},function(e){if(0==e.r){if("spoiler"===g)return c();s(e,g)}});_.fail(function(){alert("网络错误")}).always(function(){})}},c=function(t){var n=document.getElementById(a),r=n.querySelector(".spoiler");r.innerText=e.spoiler[0],r.className=r.className.replace("not-reported","disabled")},s=function(n,r){var i=document.getElementById(a);for(var o in e)if(void 0!==n[o]){var l=e[o][0]+" "+n[o],u=i.querySelector("."+o),d=u.className;(o===r||o!==r&&d.match(t))&&u.classList.toggle("disabled"),u.innerHTML=l}},f=i.length;if(1===f)o=i[0],a=o.getAttribute("data-rid"),o&&o.addEventListener("click",d,!1);else for(var g=0;g<f;g++)o=i[g],o&&o.addEventListener("click",d,!1)}}]);
  Do.ready(function(){"_REVIEW_COPY_OPTIONS"in window||(_REVIEW_COPY_OPTIONS={targetNode:".review-content",handleCopy:function(e,t){var i=t.data();if(i&&i.original){var n=["版权归作者所有，任何形式转载请联系作者。","作者："+i.author+"（来自豆瓣）","来源："+i.url,"\n\n"].join("\r\n");return n+e}}},function(e){if("undefined"!=typeof e){var t=function(){return window.getSelection?window.getSelection().toString():document.selection&&"Control"!=document.selection.type?document.selection.createRange().htmlText.replace(/<br>/gi,"\r\n"):""},i=function(e,t){if(e)try{if(e.setData("Text",t),e.getData("Text").length>0)return}catch(i){if(e.setData("text/plain",t),e.getData("text/plain").length>0)return}var i=$("<div>").css({position:"absolute",left:"-99999px"}).appendTo("body");i.html(t),window.getSelection().selectAllChildren(i[0]),window.setTimeout(function(){i.remove()},200)};$("body").delegate(e.targetNode,"copy cut",function(n){var a=t();if(!(a.length<=42)){var o=e.handleCopy&&e.handleCopy(a,$(this))||null;if(o){n.preventDefault();var r=n.originalEvent.clipboardData||window.clipboardData;i(r,o)}}})}}(window._REVIEW_COPY_OPTIONS))}),Do.global(_URL_LIBS),Do.ready(_URL_SETTING_CSS,_URL_SETTING_JS,function(){var e=function(e){var t,i,n=e+"=",a=document.cookie.split(";");for(t=0;t<a.length;t++){for(i=a[t];" "==i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(n))return i.substring(n.length,i.length).replace(/\"/g,"")}return null};$("body").delegate(".review-footer-action-setting a[data-rid]","click",function(t){t.preventDefault();var i=$(this).data(),n={review_id:i.rid,setting:{rating:i.rating,is_original:i.original,is_spoiler:i.spoiler,is_accept_reward:i.donate,is_open_reward:i.openDonate},subjectTitle:i.subjectTitle,displayRating:i.displayRating,displaySpoiler:i.displaySpoiler,onSubmit:function(t){var a={ck:e("ck")};a["review[original]"]=t.is_original?"on":"",a["review[donate]"]=t.is_accept_reward?"on":"",n.displayRating&&(a["review[rating]"]=t.rating),n.displaySpoiler&&(a["review[spoiler]"]=t.is_spoiler?"on":""),$.post(i.url,a,function(e){self.location.reload()})}};globalReviewSetting.open(n)})}),function(){!function(){var e=['<div class="popup-container hide">','<div class="popup-wrap">','<div class="popup-small">','<a class="close"></a>','<p class="popup-info">你的帐号存在安全风险<br/>写评论前请先输入验证码以证明是本人使用</p>','<div class="popup-btns">',' <a class="btn" href="javascript:;">前往验证</a>',"</div>","</div>","</div>","</div>"].join("");$("body").delegate("a.create-review, .top-tab .btn","click",function(t){t.preventDefault();var i=$(this),n=i;i.attr("href")||(n=i.find("a"));var a=$("div.popup-container"),o=n.attr("data-isverify"),r=n.attr("data-verify-url");o&&"false"!=o.toLowerCase()?location.href=n.attr("href"):(a.size()<1&&($("body").append(e),a=$("div.popup-container")),a.find(".btn").attr("href",r),a.removeClass("hide"))}).on("click","div.popup-container .close",function(){$("div.popup-container").addClass("hide")})}(),$("body").delegate(".review-footer-action-remove a","click",function(e){if(e.preventDefault(),confirm("真的就删了吗?")){var t=$(this).data(),i=$('<form action="'+t.url+'" method="POST"><input type="hidden" name="ck" value="'+get_cookie("ck")+'"/></form>').appendTo("body");i[0].submit()}})}();
});
