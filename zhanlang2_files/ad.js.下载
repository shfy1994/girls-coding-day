!function(e){function t(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function n(e){var t={};for(var n in e)e[n]&&e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function i(t,n,i,o,r){var a,d,s=n||{},c=t||[],l=i||{},p="";if("string"==typeof c&&(c=[c]),"function"==typeof l){var f=l;l={};for(var m=0;m<c.length;m++)l[c[m]]=f}if(""===s.src)throw new Error("Ad service url must be specified!");if(""===s.bid)throw new Error("Browser id must be specified!");for(var m=0,h=c.length;m<h;m++){var v=c[m],f=l[v];if(o&&o[m]){var y=o[m],b=y.id,g=[];d=y.el||"",a=e.document.getElementById(d),b=b||a.getAttribute("data-id")||"",b&&g.push(b),p=g.join(",")}else a=e.document.getElementById(v);if(n.adidstr=p,n.elid=d,w[v])if(r){var x=w[v];x.get()}else u(v+" advertising is exists");else{var x=new C(a,v,n,f);w[v]=x}}}function o(e,t,n){return this.data=e,this.wrapper=document.body,this.advertisement_id=t,this.doClick=n,this.init(),this.bindEvent(),this.open(),this}var r=2046,a="2.1.2";if(Array.prototype.filter||(Array.prototype.filter=function(e){if(void 0===this||null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var i=[],o=arguments.length>=2?arguments[1]:void 0,r=0;r<n;r++)if(r in t){var a=t[r];e.call(o,a,r,t)&&i.push(a)}return i}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n;if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),o=i.length>>>0;if(0===o)return-1;var r=+t||0;if(Math.abs(r)===1/0&&(r=0),r>=o)return-1;for(n=Math.max(r>=0?r:o-Math.abs(r),0);n<o;){if(n in i&&i[n]===e)return n;n++}return-1}),!Function.prototype.bind){var d=Array.prototype.slice,s=Object.prototype.toString,c="[object Function]";Function.proptype.bind=function(e){var t=this;if("function"!=typeof t||s.call(t)!==c)throw new Error("Function.prototype.bind called on ",t);var n=d.call(arguments,1);return function(){t.apply(t,n.concat(d.call(arguments)))}}}var l=function(e){var t,n=window,i=e&&e.ownerDocument,o={top:0,left:0};return i?(t=i.documentElement,t===e?o:("undefined"!=typeof e.getBoundingClientRect&&(o=e.getBoundingClientRect()),{top:o.top+(n.pageYOffset||t.scrollTop)-(t.clientTop||0),left:o.left+(n.pageXOffset||t.scrollLeft)-(t.clientLeft||0)})):o},u=function(t){e.console&&e.console.log(t)},p=function(t){for(;t;){if(t===e.document)return!0;t=t.parentNode}return!1},f=function(e,t){var n,i,o="";for(n in e)e.hasOwnProperty(n)&&(n=t?encodeURIComponent(n):n,i=t?encodeURIComponent(e[n]):e[n],o+=n+"="+i+"&");return o.replace(/&$/,"")},m=function(){var t,n,i,o,r,a,d,n=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},i=function(t,n){n.parentNode.removeChild(n),e[t]=void 0;try{delete e[t]}catch(e){}},o=function(){var e="",t=[],n="0123456789ABCDEF",i=0;for(i=0;i<32;i+=1)t[i]=n.charAt(Math.floor(16*Math.random()));return t[12]="4",t[16]=n.charAt(3&t[16]|8),e="erebor_"+t.join("")},r=function(e,t){"undefined"!=typeof e&&e(t)},a=function(e,t,n){"undefined"!=typeof e&&e(t,n)},d=function(e){"undefined"!=typeof e&&e()};return t={},t.get=function(t){var s=t||{},c=s.url,l=s.query||{},u=s.callbackParameter||"callback",p=o(),m=e.document.createElement("script"),h=e.document.getElementsByTagName("script")[0],v="?";if("undefined"==typeof c)throw new Error("URL must be specified!");l[u]=p,c.indexOf("?")>=0&&(v="&"),c+=v+f(l,!0),e[p]=function(e){"undefined"==typeof e?r(s.error,"Invalid JSON data returned"):a(s.success,l,e),i(p,m),d(s.complete)},m.setAttribute("src",c),h.parentNode.insertBefore(m,h),n(m,"error",function(){i(p,m),d(s.complete),r(s.error,"Error while trying to access the URL")})},t}(),h=function(){this.activeType="",this.checkVisible()};h.prototype.checkVisible=function(){function e(e){var i="visible",o="hidden",r={focus:i,focusin:i,pageshow:i,blur:o,focusout:o,pagehide:o};e=e||window.event,e.type in r?t.activeType=r[e.type]:t.activeType=document[n]?"hidden":"visible"}var t=this,n="hidden";n in document?document.addEventListener("visibilitychange",e):(n="mozHidden")in document?document.addEventListener("mozvisibilitychange",e):(n="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",e):(n="msHidden")in document?document.addEventListener("msvisibilitychange",e):"onfocusin"in document?document.onfocusin=document.onfocusout=e:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=e,void 0!==document[n]&&e({type:document[n]?"blur":"focus"})},h.prototype.isActive=function(){return"hidden"!==this.activeType&&"blur"!==this.activeType};var v=new h,y=function(e,t){for(var n=["LINK","SCRIPT","STYLE"],i=0,o=e.childNodes.length;i<o;i++){var r=e.childNodes[i],a=r.nodeName.toUpperCase();if(n.indexOf(a)<0){if(r.childNodes&&0!==r.childNodes.length)return y(r,t);if(t(r))return!0}}return!1},b=function(e,t,n,i){var o=e.document.body,r=n||Math.max(o.clientHeight,o.scrollHeight),a=i||Math.max(o.clientWidth,o.scrollWidth);e.top!==e&&t.postMessage&&t.postMessage({type:"resize",name:e.name,payload:{height:r,width:a,source:e.name}},"*")},g=function(e,t){var n=new Image,i=t?t:"https://erebor.douban.com/count/?";n.src=i+f(e)},w={},C=function(e,t,n,i){return e?p(e)?(this.request=n,this.slot=e,this.slot_id=t,this.adFrame=document.getElementById(t+"_frame"),this.loader=i,this.data={},this.rendered=!1,this.retried=!1,void this.get()):(u("ad slot:"+t+"is not in document"),null):(u("ad slot:"+t+" is not exist"),null)};C.prototype={constructor:C,setStatus:function(e){var t=this;return t.slot?t.slot.setAttribute("ad-status",e):u("slot is not exists"),t},get:function(e){var t=this,i=t.loader||t.loadFrame;t.request||u("DoubanAdRequest is not exist");var o=t.request,r=o.src;""!==o.prv&&(r+="preview/");var o=this.request,e=e||{unit:this.slot_id,uid:o.uid,bid:o.bid,crtr:o.crtr,ts:(new Date).getTime(),prv:o.prv,debug:o.debug,ad_id:o.adidstr,elid:o.elid};m.get({url:r,query:n(e),success:i.bind(t),error:u}),t.slot&&t.setStatus("loading")},retry:function(e,n){var i=this,o=t({},e);return n&&n.ad_id&&(o.ad_id=n.ad_id),i.retried||(i.setStatus("retry"),i.get(o),i.clearContent(),i.retried=!0),i},clearContent:function(){var e=this;return e.slot&&(e.slot.innerHTML=""),e},loadFrame:function(t,n){var i=this,o=(i.slot,t.unit||t.elid||""),r=t.debug||!1,a=n.debug||"";return i.data=n,i.setStatus("loaded"),r&&a&&i.openNewWindow("http://dale.dapps.douban.com/debug/view/?er="+encodeURIComponent(a)),n.err?void u(n.err):n.html?(p(i.adFrame)||(i.adFrame=e.document.createElement("iframe")),i.data.has_icon?i.innerContent=i.createInnerContent():i.innerContent=i.adFrame,i.setInnerContentStyle(),i.slot.setAttribute("data-sell-type",i.data.sell_type),i.isYoudao()&&i.closeInnerContent(),i.appendToSlot(),i.retried&&i.openInnerContent(),i):(u(o+" content is empty"),void i.retry(t,n))},appendToSlot:function(){var e=this;return e.data&&"CPC"===e.data.sell_type?e.appendCPC(e.data.html):e.innerContent?(e.slot.appendChild(e.innerContent),e.appendAdContent(e.adFrame,e.data.html),e.setFrame(),e.setStatus("appended")):e.innerContent||u(e.slot_id+" innerContent is not exit"),e},setFrame:function(){var e=this;return e.adFrame?(e.adFrame.width=e.data.width||0,e.adFrame.height=e.data.height||0,e.adFrame.style.overflow=e.data.overflow||"hidden",e.adFrame.style.display=e.data.display||"block",e.adFrame.frameBorder=e.data.frameBorder||0,e.adFrame.scrolling=e.data.scrolling||"no",e.adFrame.id=e.slot_id+"_frame",e.adFrame.name=e.data.name||e.slot_id+"_frame",e.adFrame.contentWindow.name=e.adFrame.id):u("setFrameStyle error "+e.slot_id),e},setParentHeight:function(e,t){var n=this;if(n.adFrame){var i=n.adFrame.contentWindow,o=i&&i.document?i.document.body:null,r=t?t:o?o.clientWidth:0,a=e?e:o?o.clientHeight:0;b(n.adFrame.contentWindow,window,a,r)}return n},close:function(){var e=this;return e.slot&&(e.slot.style.display="none"),e},open:function(){var e=this;return e.slot&&(e.slot.style.display="block"),e},closeInnerContent:function(){var e=this;return e.innerContent&&(e.innerContent.style.display="none"),e},openInnerContent:function(){var e=this;return e.innerContent&&(e.innerContent.style.display="block"),e},closeFrame:function(){var e=this;return e.adFrame&&(e.adFrame.style.display="none"),e},openFrame:function(){var e=this;return e.adFrame&&(e.adFrame.style.display=e.data.display||"block"),e},createInnerContent:function(){var t=this,n=t.createIcon(),i=e.document.createElement("div");return t.adFrame&&i.appendChild(t.adFrame),i.appendChild(n),i},setInnerContentStyle:function(){var e=this,t=(e.adFrame,e.innerContent);return t&&(t.style.position="relative",t.style.margin=e.data.margin||"",t.style.display="block",t.style.width=(e.data.width||0)+"px",t.style.height=(e.data.height||0)+"px"),e},createIcon:function(){var t=e.document.createElement("div");return t.innerHTML="广告",t.style.lineHeight="1",t.style.textAlign="center",t.style.backgroundColor="rgba(0, 0, 0, .3)",t.style.color="#fff",t.style.fontSize="12px",t.style.position="absolute",t.style.padding="4px",t.style.right="0",t.style.bottom="0",t},appendAdContent:function(e,t){var n=this;return e?t?(e.contentWindow.document.open(),e.contentWindow.document.write(t),e.contentWindow.document.close(),n.rendered=!0,n.checkFrameContent(),n):(u("content is not exist"),n):(u("adFrame is not exist"),n)},appendCPC:function(e){var t=this,n=(t.slot,t.slot_id),i=t.adFrame;return i&&n?(t.cpc_timer||(t.cpc_timer=setInterval(function(){!t.rendered&&v.isActive()&&t.isVisible(t.slot)&&(t.slot.appendChild(t.innerContent),t.appendAdContent(i,e),t.setFrame(),t.setStatus("appended"),clearInterval(t.cpc_timer),t.cpc_timer=null)},500)),t):t},checkFrameContent:function(){var e=this,t=e.adFrame,n=e.slot;return t&&t.contentWindow&&n&&(e.check_content_timer=setTimeout(function(){if(t&&t.contentWindow){var i=t.contentWindow.document.body,o=i.innerHTML;n.offsetWidth,n.offsetHeight;o||e.closeInnerContent()}},3e3)),e},checkSize:function(e,t,n){var i=t/2,o=n/2,r=y(e,function(e){return e.offsetWidth>=i&&e.offsetHeight>=o});return r},openNewWindow:function(t,n){var i="toolbar=0,status=1,resizable=1,menubar=no,location=yes,scrollbars=yes",o=e.window.open(t,n,i);return o&&o.focus(),o},isVisible:function(e){var t=l(e).top,n=t+parseInt(e.offsetHeight,10),i=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop,o=document.documentElement.clientHeight;return n>i&&t<i+o},isYoudao:function(){var e=this;return e.data&&e.data.order_id===r}},e.DoubanADVersion=function(){return a}(),e.DoubanAdGet=function(t,n,o){var r="string"==typeof t?[t]:t;i(r,e.DoubanAdRequest,n,null,o)},e.DoubanAdNotifyForYD=function(e,t,n,i){if(i&&i.name){var o=i.name.replace(/^(.+)_frame$/,function(e,t){return t});if(w[o]){var r=parseInt(t,10),a=parseInt(n,10),d=w[o];if(r>a){var s=d.request,c={unit:d.slot_id,uid:s.uid,bid:s.bid,crtr:s.crtr,ts:(new Date).getTime(),prv:s.prv,debug:s.debug,ad_id:d.data?d.data.ad_id:"",elid:s.elid};d.closeInnerContent(),d.retry(c)}else a>0&&(d.openInnerContent(),setTimeout(function(){var e=i.document.getElementsByTagName("iframe")[0],t=e.contentWindow.document.body,n=t.clientHeight,o=t.clientWidth;d.setParentHeight(n,o),d.setStatus("youdao-sucess")},500),g({ad:d.data?d.data.ad_id:"",uid:DoubanAdRequest.uid,bid:DoubanAdRequest.bid,unit:o,type:"impression"}))}}};var x=!1,E={};e.DoubanAdNotifyForGDT=function(e){var t=e.advertisement_id;E[t]||(E[t]={}),E[t].ad=e,x||(window.addEventListener("message",function(n){var i=n.data.type,r=n.data.name||"",a=n.data.payload,d=a.data,s=r.replace(/^(.+)_frame$/,function(e,t){return t}),c=w[s],l=c?c.adFrame:null;if("GDT.CreateAppDownloadModal"===i){var p=new o(a.data,t,function(){e.doClick.call(e)});E[t].modal=p}else if("GDT.Resize"===i)try{b(l.contentWindow,window,d.height,d.width)}catch(e){u(e)}else if("GDT.Expose"===i)g({ad:c.data?c.data.ad_id:"",uid:DoubanAdRequest.uid,bid:DoubanAdRequest.bid,unit:s,type:"impression"});else if("GDT.Click"===i){var f="https://erebor.douban.com/redirect/?";g({ad:c.data?c.data.ad_id:"",uid:DoubanAdRequest.uid,bid:DoubanAdRequest.bid,unit:s},f)}}),x=!0)},e.DoubanAdSetParentHeight=function(e,t,n,i){b(e,t,n,i)},i(e.DoubanAdSlots,e.DoubanAdRequest,e.DoubanAdLoaders,e.adElements);var F="DoubanAdJsLoaded";if(e.AD_JS_LOADED_EVENT_NAME=F,e.document.createEvent){var _=document.createEvent("Event");_.initEvent(F,!0,!0),e.document.body&&e.document.body.dispatchEvent&&e.document.body.dispatchEvent(_)}o.prototype={constructor:o,init:function(){var e=this,t=e.advertisement_id,n=document.createElement("div"),i=document.createElement("em"),o=document.createElement("div"),r="gdt-app-ad-"+t+"-modal",a=r+"container",d="position: fixed;z-index: 10000;left: 0;right: 0;top: 0;bottom: 0;",s="position: absolute; z-index: 10000; left: 0; right: 0; top: 0; bottom: 0; background-color: rgba(0,0,0,0.5);",c="box-sizing: border-box; border-radius: 8px; overflow: hidden;position: absolute;top: 25%; left: 50%; transform: translateX(-50%); width: 90%; z-index: 10001;padding: 20px 18px 15px 18px;background-color: #fff;",l="clear: both; overflow: hidden;margin-bottom: 30px",u="float: left; width: 100px;height: 100px;",p="margin-left: 115px;overflow: hidden;",f="line-height: 30px;font-size: 24px;",m="height: 12px;width: 60px;margin-bottom: 10px;",h="line-height: 15px;font-size: 15px;",v="text-align: center;margin-bottom: 40px;",y="display: inline-block; margin-right: 10px; width: 140px;height: 36px;line-height: 36px;background-color: #42bd56;border-radius: 4px;color: #fff;",b="display: inline-block;margin-left: 10px; width: 70px;line-height: 34px;height: 34px;border: 1px solid #aaa;color: #aaa;border-radius: 4px;",g='<div id="content-'+t+'" style="'+l+'"><span id="avatar-'+t+'" style="'+u+'"></span><div id="info-+advertisement_id+" style="'+p+'"><p id="title-'+t+'" style="'+f+'"></p><div id="score-'+t+'" style="'+m+'"></div><p id="size-'+t+'" style="'+h+'"></p></div></div>',w='<div id="buttons-'+t+'" style="'+v+'"><a id="download-'+t+'" style="'+y+'">直接下载</a><a id="cancel-'+t+'" style="'+b+'">取消</a></div>';return n.id=r,n.style=d,o.id=a,o.style=c,i.style=s,o.innerHTML=g+w,n.appendChild(o),n.appendChild(i),e.wrapper.appendChild(n),e.modal=n,e.container=o,e},bindEvent:function(){var e=this,t=document.getElementById("download-"+e.advertisement_id);t.addEventListener("click",function(t){t.preventDefault(),e.doClick()});var n=document.getElementById("cancel-"+e.advertisement_id);return n.addEventListener("click",function(t){t.preventDefault(),e.close()}),e},open:function(){var e=this;return e.modal.style.display="block",e},close:function(){var e=this;return e.modal.style.display="none",e.wrapper.removeChild(e.modal),e=null}}}(this);